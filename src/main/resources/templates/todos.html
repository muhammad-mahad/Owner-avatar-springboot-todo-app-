<!DOCTYPE html>
<html lang="en">
	<head>
	    <meta charset="UTF-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	    <!-- Bootstrap CSS -->
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
		<!-- https://iconscout.com/free-icon/list-4903355 -->
		<link rel="icon" th:href="@{/logo/todos.ico}" type="image/x-icon">
		<title>List Todos Page</title>
	</head>
	<body>
		<nav class="navbar navbar-expand-md navbar-light bg-light mb-3 p-1">
			<a class="navbar-brand" href="/">
                <img src="../static/logo/todos.ico"  th:src="@{/logo/todos.ico}" alt="Favicon" width="30" height="30" class="d-inline-block align-top">
            </a>
			<a class="navbar-brand m-1" href="https://www.linkedin.com/in/muhammad-mahad/">Muhammad Mahad</a>
			<div class="collapse navbar-collapse">
				<ul class="navbar-nav">
					<li class="nav-item"><a class="nav-link" href="https://github.com/muhammad-mahad">Home</a></li>
					<li class="nav-item"><a class="nav-link" href="/allTodos">Todos</a></li>
				</ul>
			</div>	
		</nav>
		<!-- Alert for Completed Todos -->
		<div th:if="${T(com.spring.project.crudapp.services.TodoCollectorsMap).isAllCompleted(todo)}" class="alert alert-success">
		    <strong>Well done!</strong> You have completed todos.
		</div>
		<!-- Alert for Expired Todos --> 
		<div th:if="${T(com.spring.project.crudapp.services.TodoCollectorsMap).isAnyMissed(todo)}" class="alert alert-danger">
		    <strong>Attention!</strong> Some todos have passed their deadline.
		</div>
		<div class="container">
			<h1>Your Todos</h1>
			<table class="table">
				<thead class="thead-dark">
					<tr style="font-weight:bold">
						<th>id</th>
						<th>Description</th>
						<th>Target Date</th>
						<th>Is Done?</th>
						<th></th>
						<th></th>
					</tr>
				</thead>
				<tbody>	
					<tr th:each="todo:${todo}">
						<td th:text="${todo.getId()}">id</td>
						<td th:text="${todo.getDescription()}">Description</td>
						<td th:text="${todo.getLocalDate()}">Target Date</td>
						<td  th:class="${todo.isDone() ? 'table-success' : todo.isInPast() ? 'table-danger' : ''}">
			                <span th:if="${todo.isDone()}" class="badge badge-success">Completed</span>
			                <span th:if="${todo.isInPast() && !todo.isDone()}" class="badge badge-danger">Expired</span>
			                <span th:unless="${todo.isDone() || (todo.isInPast() && !todo.isDone())}" class="badge badge-secondary">Pending</span>
			            </td>
						<td> <a th:href="@{/deleteTodo/(id=${todo.getId()})}" id="deleteButton" data-toggle="modal" data-target="#deleteModal" class="btn btn-warning">Delete</a>   </td>
						<td> <a th:href="@{/updateTodo/(id=${todo.getId()})}" class="btn btn-success">Update</a>   </td>
					</tr>
				</tbody>
			</table>
			<a href="addTodo" class="btn btn-success">Add Todo</a>
			
			<div class="modal fade" tabindex="-1" role="dialog" id="deleteModal" aria-labelledby="deleteModalLabel" aria-hidden="true">
			  <div class="modal-dialog" role="document">
			    <div class="modal-content">
			      <div class="modal-header">
			        <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
			        <button type="button" class="close closeModel" data-dismiss="modal" aria-label="Close">
			          <span aria-hidden="true">&times;</span>
			        </button>
			      </div>
			      <div class="modal-body">
			        <p>Are you sure you want to delete this record?</p>
			      </div>
			      <div class="modal-footer">
			        <a href="" id="delRef" class="btn btn-primary">Yes, Delete</a>
			        <button type="button" class="btn btn-secondary closeModel" data-dismiss="modal">Close</button>
			      </div>
			    </div>
			  </div>
			</div>
		</div>
		<!-- jQuery -->
    	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
		<!-- Bootstrap JS and Popper.js (required for Bootstrap components) -->
	    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	    <script>
	        $('.table #deleteButton').on('click',function(event){
	    		event.preventDefault();		
	    		var href = $(this).attr('href');
	    		$('#deleteModal #delRef').attr('href', href);		
	    		$('#deleteModal').modal('toggle');
	    	});
	        $('.closeModel').on('click', function(event) {
	    		event.preventDefault();				
	    		$('#deleteModal').modal('toggle');
	    	});
		</script>
	</body>
</html>